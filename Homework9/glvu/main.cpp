#define _CRT_SECURE_NO_WARNINGS
#define _SCL_SECURE_NO_WARNINGS

#define FREEGLUT_STATIC
#include "gl_core_3_3.h"
#include <GL/glut.h>
#include <GL/freeglut_ext.h>
#include <GL/GL.h>

#define TW_STATIC
#include <AntTweakBar.h>


#include <ctime>
#include <memory>
#include <vector>
#include <string>
#include <cstdlib>

#include "objloader.h"
#include "glprogram.h"
#include "MyImage.h"
#include "VAOImage.h"
#include "VAOMesh.h"
#include "trackball.h"

#include "laplacian.h"


GLProgram MyMesh::prog, MyMesh::pickProg, MyMesh::pointSetProg;
GLTexture MyMesh::colormapTex;

MyMesh M;
int viewport[4] = { 0, 0, 1280, 960 };
int actPrimType = MyMesh::PE_VERTEX;

std::string imagefile = "bricks2.jpg";
bool showATB = true;


using MatX3f = Eigen::Matrix<float, Eigen::Dynamic, 3, Eigen::RowMajor>;
using MatX3i = Eigen::Matrix<int, Eigen::Dynamic, 3, Eigen::RowMajor>;
MatX3f meshX;
MatX3i meshF;

void deform_preprocess()
{
    auto L = Laplacian(meshX, meshF);
}

Eigen::MatrixXf union_weight(Eigen::MatrixXi adjacency_matrix, std::vector<int> P2PVtxIds, int N, int n, double labmda)
{
    using namespace Eigen;
    MatrixXf laplacian_matrix(N + n, N);
    laplacian_matrix.fill(0);
    for (int i = 0; i < N + n; i++)
    {

        if (i < N)
        {
            int num = 0;
            for (int j = 0; j < N - 1; j++)
            {

                if (adjacency_matrix(i, j) == 1)
                {
                    laplacian_matrix(i, j) = 1;
                    num++;
                }
                /*else
                {
                    laplacian_matrix(i, j) = 0;
                }*/
            }
            laplacian_matrix.row(i) /= num;
            laplacian_matrix(i, i) = -1;
        }
        else
        {
            for (int j = 0; j < N; j++)
            {
                if (j == P2PVtxIds[i - N]) laplacian_matrix(i, j) = labmda;
                else laplacian_matrix(i, j) = 0;
            }
        }
    }
    return laplacian_matrix;
}

Eigen::Matrix<float, Eigen::Dynamic, Eigen::Dynamic, Eigen::RowMajor> laplacian_mesh_iditing(std::vector<int> P2PVtxIds, std::vector<float> p2pDsts)
{
    using namespace Eigen;
    double labmda = 10.;
    //建立邻接矩阵
    const int N = meshX.rows();
    MatrixXi adjacency_matrix(N, N);
    //初始化邻接矩阵
    adjacency_matrix.fill(0);
    /*for (int i = 0; i < N; i++)
    {
        for (int j = 0; j < N; j++)
        {
            adjacency_matrix(i, j) = 0;
        }
    }*/
    int M = meshF.rows();
    for (int i = 0; i < M; i++)
    {
        adjacency_matrix(meshF(i, 0), meshF(i, 1)) = 1; adjacency_matrix(meshF(i, 1), meshF(i, 0)) = 1;
        adjacency_matrix(meshF(i, 1), meshF(i, 2)) = 1; adjacency_matrix(meshF(i, 2), meshF(i, 1)) = 1;
        adjacency_matrix(meshF(i, 2), meshF(i, 0)) = 1; adjacency_matrix(meshF(i, 0), meshF(i, 2)) = 1;
    }
    //构造laplace矩阵
    MatX3f P2PDsts = Map<MatX3f>(p2pDsts.data(), p2pDsts.size() / 3, 3) * labmda;//目标点坐标
    int n = P2PDsts.rows();
    //初始化laplace矩阵
    MatrixXf laplacian_matrix=union_weight(adjacency_matrix,P2PVtxIds,N,n,labmda);//均匀权重
    //MatrixXf laplacian_matrix = cot_weight(adjacency_matrix, P2PVtxIds, N, n, labmda);//cot权重
    //将四元数组转化为旋转矩阵
    //MatrixXf rotation = Rotation(R);
    // std::cout << "{ " << R[0] << ' ' << R[1] << ' ' << R[2] << ' ' << R[3] << " }" << std::endl;
    //计算laplace坐标
    MatrixXf L = laplacian_matrix.topRows(N);
    MatrixXf delta = L * meshX;
    MatrixXf Delta(N + n, 3);
    for (int i = 0; i < N + n; i++)
    {
        if (i < N)
        {
            /*for (int j = 0; j < 3; j++)
            {
                Delta(i, j) = delta(i, j);
            }*/
            Delta.row(i) = delta.row(i);
        }
        else
        {
            Delta.row(i) = P2PDsts.row(i - N);
        }
    }
    // 对选定点作用旋转矩阵
    //Delta.row(P2PVtxIds[n - 1]) = Delta.row(P2PVtxIds[n - 1]) * rotation.transpose();
    // Delta.row(N+n-1) = Delta.row(N+n-1) * rotation.transpose();
    /*for (int i = 0; i < N + n; i++)
    {
        for (int j = 0; j < N; j++)
        {
            std::cout << laplacian_matrix(i, j) << ' ';
        }
        std::cout << std::endl;
    }*/

    MatrixXf y(N, 3);
    //for (int i = 0; i < 3; i++)
    //{
    //    y.col(i) = laplacian_matrix.householderQr().solve(Delta.col(i));
    //    
    //    y.col(i) = laplacian_matrix.colPivHouseholderQr().solve(Delta.col(i));
    //}
    y = laplacian_matrix.householderQr().solve(Delta);
    //y = (laplacian_matrix.transpose() * laplacian_matrix).ldlt().solve(laplacian_matrix.transpose() * Delta);
    return y;
}

void meshDeform()
{
    using namespace Eigen;

    std::vector<int> P2PVtxIds = M.getConstrainVertexIds();
    std::vector<float> p2pDsts = M.getConstrainVertexCoords();


    // TODO 2: compute deformation result y using Laplacian coordinates


    Matrix<float, Dynamic, Dynamic, RowMajor> y;
    y = laplacian_mesh_iditing(P2PVtxIds, p2pDsts);
    if (y.cols() > 3)  y = y.leftCols(3);
    if (y.rows() == 0 || y.cols() != 3) return;

    M.upload(y.data(), y.rows(), nullptr, 0, nullptr);
}

int mousePressButton;
int mouseButtonDown;
int mousePos[2];

bool msaa = true;

float myRotation[4] = {1, 0, 0, 0}; //BONUS: interactively specify the rotation for the Laplacian coordinates at the handles

void display()
{
    /*glEnable(GL_LIGHT0);
    glEnable(GL_AUTO_NORMAL);*/
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
    glEnable(GL_DEPTH_TEST);

    if (msaa) glEnable(GL_MULTISAMPLE);
    else glDisable(GL_MULTISAMPLE);

    glViewport(0, 0, viewport[2], viewport[3]);
    M.draw(viewport);

    if (showATB) TwDraw();
    glutSwapBuffers();

    //glFinish();
}

void onKeyboard(unsigned char code, int x, int y)
{
    if (!TwEventKeyboardGLUT(code, x, y)) {
        switch (code) {
        case 17:
            exit(0);
        case 'f':
            glutFullScreenToggle();
            break;
        case ' ':
            showATB = !showATB;
            break;
        }
    }

    glutPostRedisplay();
}

void onMouseButton(int button, int updown, int x, int y)
{
    if (!showATB || !TwEventMouseButtonGLUT(button, updown, x, y)) {
        mousePressButton = button;
        mouseButtonDown = updown;

        if (updown == GLUT_DOWN) {
            if (button == GLUT_LEFT_BUTTON) {
                if (glutGetModifiers()&GLUT_ACTIVE_CTRL) {
                }
                else {
                    int r = M.pick(x, y, viewport, M.PE_VERTEX, M.PO_ADD);
                }
            }
            else if (button == GLUT_RIGHT_BUTTON) {
                M.pick(x, y, viewport, M.PE_VERTEX, M.PO_REMOVE);
            }
        }
        else { // updown == GLUT_UP
            if (button == GLUT_LEFT_BUTTON);
        }

        mousePos[0] = x;
        mousePos[1] = y;
    }

    glutPostRedisplay();
}


void onMouseMove(int x, int y)
{
    if (!showATB || !TwEventMouseMotionGLUT(x, y)) {
        if (mouseButtonDown == GLUT_DOWN) {
            if (mousePressButton == GLUT_MIDDLE_BUTTON) {
                M.moveInScreen(mousePos[0], mousePos[1], x, y, viewport);
            }
            else if (mousePressButton == GLUT_LEFT_BUTTON) {
                if (!M.moveCurrentVertex(x, y, viewport)) {
                    meshDeform();
                }
                else {
                    const float s[2] = { 2.f / viewport[2], 2.f / viewport[3] };
                    auto r = Quat<float>(M.mQRotate)*Quat<float>::trackball(x*s[0] - 1, 1 - y*s[1], s[0]*mousePos[0] - 1, 1 - s[1]*mousePos[1]);
                    std::copy_n(r.q, 4, M.mQRotate);
                }
            }
        }
    }

    mousePos[0] = x; mousePos[1] = y;

    glutPostRedisplay();
}


void onMouseWheel(int wheel_number, int direction, int x, int y)
{
    M.mMeshScale *= direction > 0 ? 1.1f : 0.9f;
    glutPostRedisplay();
}

int initGL(int argc, char **argv)
{
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGBA | GLUT_MULTISAMPLE);
    glutInitWindowSize(960, 960);
    glutInitWindowPosition(200, 50);
    glutCreateWindow(argv[0]);

    // !Load the OpenGL functions. after the opengl context has been created
    if (ogl_LoadFunctions() == ogl_LOAD_FAILED)
        return -1;

    glClearColor(1.f, 1.f, 1.f, 0.f);

    glutReshapeFunc([](int w, int h) { viewport[2] = w; viewport[3] = h; TwWindowSize(w, h); });
    glutDisplayFunc(display);
    glutKeyboardFunc(onKeyboard);
    glutMouseFunc(onMouseButton);
    glutMotionFunc(onMouseMove);
    glutMouseWheelFunc(onMouseWheel);
    glutCloseFunc([]() {exit(0); });
    return 0;
}


void createTweakbar()
{
    TwBar *bar = TwGetBarByName("MeshViewer");
    if (bar)    TwDeleteBar(bar);

    //Create a tweak bar
    bar = TwNewBar("MeshViewer");
    TwDefine(" MeshViewer size='220 100' color='0 128 255' text=dark alpha=128 position='5 5'"); // change default tweak bar size and color

    TwAddVarRO(bar, "#Vertex", TW_TYPE_INT32, &M.nVertex, " group='Mesh View'");
    TwAddVarRO(bar, "#Face", TW_TYPE_INT32, &M.nFace, " group='Mesh View'");

    TwAddVarRW(bar, "Point Size", TW_TYPE_FLOAT, &M.pointSize, " group='Mesh View' ");
    TwAddVarRW(bar, "Vertex Color", TW_TYPE_COLOR4F, M.vertexColor.data(), " group='Mesh View' help='mesh vertex color' ");


    TwAddVarRW(bar, "Edge Width", TW_TYPE_FLOAT, &M.edgeWidth, " group='Mesh View' ");
    TwAddVarRW(bar, "Edge Color", TW_TYPE_COLOR4F, M.edgeColor.data(), " group='Mesh View' help='mesh edge color' ");

    TwAddVarRW(bar, "Face Color", TW_TYPE_COLOR4F, M.faceColor.data(), " group='Mesh View' help='mesh face color' ");

    TwDefine(" MeshViewer/'Mesh View' opened=false ");

    TwAddVarRW(bar, "Rotation", TW_TYPE_QUAT4F, myRotation, " group='Modeling' open help='can be used to specify the rotation for current handle' ");
}

int main(int argc, char *argv[])
{
    if (initGL(argc, argv)) {
        fprintf(stderr, "!Failed to initialize OpenGL!Exit...");
        exit(-1);
    }

    MyMesh::buildShaders();

    std::vector<float> x;
    std::vector<int> f;

    const char* meshpath = argc > 1 ? argv[1] : "balls.obj";
    readObj(meshpath, x, f);

    // float uv[] = { 0.989074 , 0.603956 ,0.975528 , 0.654508 ,0.956773 , 0.703368 ,0.933013 , 0.750000 ,0.904508 , 0.793893 ,0.871572 , 0.834565 ,0.834565 , 0.871572 ,0.793893 , 0.904508 ,0.750000 , 0.933013 ,0.703368 , 0.956773 ,0.654508 , 0.975528 ,0.603956 , 0.989074 ,0.552264 , 0.997261 ,0.500000 , 1.000000 ,0.447736 , 0.997261 ,0.396044 , 0.989074 ,0.345492 , 0.975528 ,0.296632 , 0.956773 ,0.250000 , 0.933013 ,0.997261 , 0.552264 ,0.206107 , 0.904508 ,0.992325 , 0.551595 ,0.982965 , 0.550160 ,0.943601 , 0.543163 ,0.906120 , 0.536412 ,0.881150 , 0.532324 ,0.818751 , 0.522723 ,0.766404 , 0.519146 ,0.746398 , 0.516613 ,0.718721 , 0.510062 ,0.675707 , 0.501987 ,0.645113 , 0.500657 ,0.604090 , 0.503963 ,0.564676 , 0.504226 ,0.537273 , 0.501028 ,0.511702 , 0.496853 ,0.502899 , 0.495855 ,0.499773 , 0.495512 ,0.496075 , 0.495136 ,0.209118 , 0.901055 ,0.214931 , 0.895126 ,0.239975 , 0.873780 ,0.264020 , 0.853674 ,0.280268 , 0.838374 ,0.321214 , 0.797282 ,0.359493 , 0.752684 ,0.374427 , 0.734886 ,0.395883 , 0.708292 ,0.423442 , 0.666006 ,0.436118 , 0.635511 ,0.447478 , 0.594094 ,0.458809 , 0.555271 ,0.472062 , 0.530601 ,0.487095 , 0.508709 ,0.492157 , 0.501102 ,0.493953 , 0.498387 ,0.612109 , 0.678144 ,0.889479 , 0.707942 ,0.840904 , 0.670487 ,0.790407 , 0.644314 ,0.741139 , 0.633697 ,0.698911 , 0.636948 ,0.671181 , 0.644440 ,0.650228 , 0.658803 ,0.894330 , 0.579123 ,0.898882 , 0.654308 ,0.836281 , 0.610419 ,0.774413 , 0.591561 ,0.713363 , 0.595085 ,0.676270 , 0.621971 ,0.654140 , 0.641537 ,0.638437 , 0.656055 ,0.637270 , 0.645737 ,0.651452 , 0.622216 ,0.668573 , 0.591602 ,0.687701 , 0.546691 ,0.746536 , 0.543126 ,0.872054 , 0.752549 ,0.835248 , 0.716938 ,0.795124 , 0.689000 ,0.754582 , 0.670719 ,0.715157 , 0.663557 ,0.676357 , 0.662940 ,0.649145 , 0.669700 ,0.848049 , 0.791492 ,0.822026 , 0.755033 ,0.791899 , 0.726616 ,0.757705 , 0.704928 ,0.727961 , 0.688819 ,0.691990 , 0.688217 ,0.657886 , 0.678914 ,0.818225 , 0.826374 ,0.799908 , 0.786536 ,0.784999 , 0.756066 ,0.756294 , 0.737733 ,0.720370 , 0.716677 ,0.686369 , 0.711041 ,0.659830 , 0.695569 ,0.783977 , 0.858235 ,0.771281 , 0.815842 ,0.754869 , 0.774411 ,0.727921 , 0.747701 ,0.694348 , 0.738300 ,0.665307 , 0.716441 ,0.645319 , 0.700656 ,0.745147 , 0.887237 ,0.740750 , 0.843877 ,0.729954 , 0.805616 ,0.713726 , 0.771384 ,0.684794 , 0.764249 ,0.661949 , 0.740611 ,0.644029 , 0.712469 ,0.696755 , 0.917613 ,0.705506 , 0.866174 ,0.708635 , 0.830160 ,0.690466 , 0.798025 ,0.663482 , 0.772924 ,0.646222 , 0.753399 ,0.635462 , 0.726493 ,0.653499 , 0.923513 ,0.665255 , 0.881054 ,0.676497 , 0.837105 ,0.656174 , 0.804737 ,0.641287 , 0.776525 ,0.628930 , 0.750442 ,0.619530 , 0.723894 ,0.624654 , 0.943930 ,0.626322 , 0.899441 ,0.632949 , 0.842479 ,0.632365 , 0.801363 ,0.620548 , 0.776282 ,0.610533 , 0.746060 ,0.610616 , 0.718332 ,0.584988 , 0.932094 ,0.596586 , 0.873575 ,0.599525 , 0.835763 ,0.610865 , 0.806795 ,0.599311 , 0.776506 ,0.594503 , 0.751732 ,0.600291 , 0.725230 ,0.532139 , 0.937301 ,0.558992 , 0.884077 ,0.576738 , 0.847592 ,0.580490 , 0.808376 ,0.578929 , 0.769791 ,0.583451 , 0.741071 ,0.590533 , 0.716044 ,0.481187 , 0.932638 ,0.515405 , 0.877734 ,0.548099 , 0.836169 ,0.549960 , 0.786018 ,0.565858 , 0.755043 ,0.570595 , 0.728586 ,0.586218 , 0.707188 ,0.426837 , 0.920531 ,0.465004 , 0.863004 ,0.507008 , 0.813215 ,0.522983 , 0.769778 ,0.546354 , 0.749752 ,0.550118 , 0.725022 ,0.571633 , 0.705979 ,0.366085 , 0.901266 ,0.404967 , 0.839942 ,0.454619 , 0.793964 ,0.492985 , 0.765840 ,0.518610 , 0.734064 ,0.543398 , 0.706728 ,0.567360 , 0.690209 ,0.301955 , 0.885240 ,0.396044 , 0.763604 ,0.461705 , 0.718179 ,0.512728 , 0.703152 ,0.539941 , 0.681939 ,0.569719 , 0.678255 ,0.461047 , 0.653833 ,0.499985 , 0.674852 ,0.526932 , 0.657649 ,0.559466 , 0.662728 ,0.497556 , 0.634358 ,0.537712 , 0.634370 ,0.570382 , 0.646012 ,0.480525 , 0.560709 ,0.512180 , 0.591348 ,0.559757 , 0.614123 ,0.582868 , 0.640695 ,0.499469 , 0.502973 ,0.512099 , 0.532232 ,0.550130 , 0.569551 ,0.575802 , 0.592384 ,0.589223 , 0.624501 ,0.558459 , 0.528317 ,0.582483 , 0.558902 ,0.597417 , 0.594845 ,0.607387 , 0.626812 ,0.609000 , 0.564351 ,0.620606 , 0.602120 ,0.617578 , 0.634452 ,0.650603 , 0.523045 ,0.640403 , 0.561927 ,0.642249 , 0.601719 ,0.630211 , 0.630731 ,0.494494 , 0.491527 ,0.493139 , 0.488555 ,0.489301 , 0.480272 ,0.477412 , 0.458702 ,0.464292 , 0.436600 ,0.445366 , 0.404315 ,0.426256 , 0.370143 ,0.412100 , 0.345097 ,0.394790 , 0.304819 ,0.384505 , 0.275971 ,0.375092 , 0.255683 ,0.347724 , 0.203380 ,0.337199 , 0.142280 ,0.331172 , 0.119195 ,0.317589 , 0.087954 ,0.302307 , 0.055566 ,0.298607 , 0.047563 ,0.296632 , 0.043227 ,0.345492 , 0.024472 ,0.396044 , 0.010926 ,0.447736 , 0.002739 ,0.500000 , 0.000000 ,0.552264 , 0.002739 ,0.603956 , 0.010926 ,0.654508 , 0.024472 ,0.703368 , 0.043227 ,0.750000 , 0.066987 ,0.793893 , 0.095492 ,0.834565 , 0.128428 ,0.871572 , 0.165435 ,0.904508 , 0.206107 ,0.933013 , 0.250000 ,0.956773 , 0.296632 ,0.975528 , 0.345492 ,0.989074 , 0.396044 ,0.997261 , 0.447736 ,1.000000 , 0.500000 ,0.594885 , 0.322391 ,0.498534 , 0.064684 ,0.485781 , 0.117414 ,0.482675 , 0.177816 ,0.492578 , 0.228777 ,0.511898 , 0.263969 ,0.529559 , 0.284460 ,0.553313 , 0.296294 ,0.372258 , 0.111001 ,0.447053 , 0.065005 ,0.429022 , 0.148269 ,0.438641 , 0.214996 ,0.471800 , 0.269056 ,0.509068 , 0.286498 ,0.533481 , 0.303353 ,0.558835 , 0.309558 ,0.553660 , 0.316196 ,0.531329 , 0.318814 ,0.498602 , 0.311652 ,0.443771 , 0.314827 ,0.408046 , 0.262676 ,0.530362 , 0.045738 ,0.529473 , 0.095264 ,0.527927 , 0.153447 ,0.522100 , 0.203993 ,0.528352 , 0.242835 ,0.540033 , 0.272186 ,0.563083 , 0.285814 ,0.571540 , 0.066001 ,0.562695 , 0.124302 ,0.561204 , 0.162603 ,0.551560 , 0.192736 ,0.549509 , 0.228343 ,0.553996 , 0.259744 ,0.573188 , 0.278455 ,0.622454 , 0.068965 ,0.599578 , 0.114075 ,0.586450 , 0.154420 ,0.577386 , 0.188108 ,0.571235 , 0.219924 ,0.569809 , 0.250828 ,0.584169 , 0.273499 ,0.667170 , 0.080549 ,0.637970 , 0.117764 ,0.616357 , 0.152997 ,0.601479 , 0.184438 ,0.592389 , 0.214527 ,0.586756 , 0.245004 ,0.596204 , 0.270819 ,0.709580 , 0.098827 ,0.675140 , 0.130037 ,0.647121 , 0.159965 ,0.625547 , 0.187317 ,0.610743 , 0.209259 ,0.606734 , 0.240426 ,0.608477 , 0.272772 ,0.750511 , 0.123060 ,0.711294 , 0.149099 ,0.677702 , 0.174019 ,0.650013 , 0.197655 ,0.627569 , 0.219589 ,0.624998 , 0.251015 ,0.619561 , 0.279210 ,0.791344 , 0.153480 ,0.746952 , 0.174474 ,0.707880 , 0.194179 ,0.674762 , 0.213181 ,0.647377 , 0.231860 ,0.640273 , 0.262230 ,0.629172 , 0.287643 ,0.839069 , 0.192818 ,0.783072 , 0.206610 ,0.737614 , 0.220414 ,0.698955 , 0.233885 ,0.666645 , 0.247489 ,0.653888 , 0.276165 ,0.637254 , 0.298217 ,0.871571 , 0.244096 ,0.816848 , 0.245573 ,0.766608 , 0.252903 ,0.722216 , 0.260435 ,0.684613 , 0.267612 ,0.665368 , 0.293799 ,0.642956 , 0.311089 ,0.890232 , 0.283555 ,0.845759 , 0.286520 ,0.795007 , 0.290491 ,0.744893 , 0.293893 ,0.700611 , 0.293901 ,0.672885 , 0.315809 ,0.644386 , 0.325229 ,0.924625 , 0.312047 ,0.876189 , 0.325115 ,0.824707 , 0.330289 ,0.771226 , 0.333768 ,0.713689 , 0.331859 ,0.670304 , 0.338979 ,0.640898 , 0.337876 ,0.916017 , 0.371486 ,0.855796 , 0.366795 ,0.804265 , 0.379043 ,0.744797 , 0.377031 ,0.691107 , 0.369630 ,0.658857 , 0.353474 ,0.636058 , 0.349306 ,0.933110 , 0.426869 ,0.857800 , 0.428042 ,0.771262 , 0.438336 ,0.717234 , 0.409553 ,0.676951 , 0.404933 ,0.655920 , 0.371579 ,0.629728 , 0.361209 ,0.905399 , 0.491038 ,0.753931 , 0.494120 ,0.702053 , 0.457837 ,0.652571 , 0.430077 ,0.642819 , 0.390920 ,0.618958 , 0.371852 ,0.650050 , 0.473631 ,0.620769 , 0.447268 ,0.622784 , 0.405871 ,0.604574 , 0.378867 ,0.598104 , 0.453822 ,0.597013 , 0.416244 ,0.589230 , 0.377979 ,0.558881 , 0.483595 ,0.570545 , 0.447812 ,0.573084 , 0.402086 ,0.576592 , 0.370308 ,0.500650 , 0.488082 ,0.517822 , 0.460946 ,0.544818 , 0.414029 ,0.560309 , 0.386146 ,0.565453 , 0.362939 ,0.482088 , 0.433276 ,0.505546 , 0.405816 ,0.541600 , 0.381368 ,0.553877 , 0.354480 ,0.487535 , 0.381984 ,0.519596 , 0.364796 ,0.547852 , 0.340907 ,0.441425 , 0.357478 ,0.479632 , 0.353008 ,0.521130 , 0.336007 ,0.549771 , 0.326863 ,0.165435 , 0.871572 ,0.128428 , 0.834565 ,0.095492 , 0.793893 ,0.066987 , 0.750000 ,0.043227 , 0.703368 ,0.024472 , 0.654508 ,0.010926 , 0.603956 ,0.002739 , 0.552264 ,0.000000 , 0.500000 ,0.002739 , 0.447736 ,0.010926 , 0.396044 ,0.024472 , 0.345492 ,0.043227 , 0.296632 ,0.066987 , 0.250000 ,0.095492 , 0.206107 ,0.128428 , 0.165435 ,0.165435 , 0.128428 ,0.206107 , 0.095492 ,0.250000 , 0.066987 ,0.297655 , 0.493302 ,0.122988 , 0.733130 ,0.180996 , 0.713448 ,0.232217 , 0.687115 ,0.267988 , 0.659239 ,0.273056 , 0.612530 ,0.285658 , 0.576261 ,0.286235 , 0.544514 ,0.233884 , 0.817301 ,0.166438 , 0.773682 ,0.236843 , 0.749753 ,0.286308 , 0.709692 ,0.313299 , 0.649797 ,0.305807 , 0.595222 ,0.301134 , 0.559607 ,0.298537 , 0.534149 ,0.309126 , 0.539173 ,0.321443 , 0.568321 ,0.340252 , 0.604816 ,0.373394 , 0.652115 ,0.346288 , 0.714964 ,0.086630 , 0.684239 ,0.141383 , 0.683517 ,0.186108 , 0.653493 ,0.235060 , 0.637062 ,0.241527 , 0.600694 ,0.262057 , 0.569434 ,0.272367 , 0.534331 ,0.077162 , 0.631873 ,0.130191 , 0.633273 ,0.173450 , 0.610733 ,0.209462 , 0.609304 ,0.227997 , 0.575140 ,0.247557 , 0.542564 ,0.268331 , 0.521843 ,0.046765 , 0.597182 ,0.097751 , 0.590166 ,0.148854 , 0.578892 ,0.192632 , 0.578702 ,0.214750 , 0.550143 ,0.231650 , 0.529883 ,0.255746 , 0.517174 ,0.067538 , 0.550322 ,0.115996 , 0.549451 ,0.150676 , 0.541920 ,0.181281 , 0.548001 ,0.207384 , 0.526565 ,0.232812 , 0.512968 ,0.256472 , 0.502486 ,0.044679 , 0.498933 ,0.097298 , 0.513935 ,0.133860 , 0.521472 ,0.173388 , 0.511783 ,0.210424 , 0.506615 ,0.235196 , 0.495085 ,0.260951 , 0.493901 ,0.052665 , 0.455109 ,0.089772 , 0.473164 ,0.131944 , 0.490270 ,0.168197 , 0.472750 ,0.203338 , 0.486672 ,0.227898 , 0.478224 ,0.254480 , 0.484731 ,0.043238 , 0.423492 ,0.082897 , 0.432219 ,0.129149 , 0.448518 ,0.166436 , 0.443682 ,0.204925 , 0.455574 ,0.241552 , 0.469058 ,0.263625 , 0.478816 ,0.066963 , 0.386352 ,0.115598 , 0.406679 ,0.149197 , 0.420864 ,0.180711 , 0.420702 ,0.213701 , 0.424680 ,0.237570 , 0.448826 ,0.260815 , 0.468174 ,0.080323 , 0.333156 ,0.111288 , 0.367381 ,0.154091 , 0.384739 ,0.195918 , 0.394672 ,0.222331 , 0.403704 ,0.240749 , 0.424603 ,0.263675 , 0.450867 ,0.096519 , 0.277099 ,0.139467 , 0.325981 ,0.186461 , 0.356891 ,0.218214 , 0.377317 ,0.243075 , 0.397248 ,0.264139 , 0.422294 ,0.281124 , 0.448005 ,0.153617 , 0.250718 ,0.193967 , 0.311883 ,0.217109 , 0.346756 ,0.244387 , 0.364630 ,0.268633 , 0.390938 ,0.287580 , 0.422101 ,0.292570 , 0.451460 ,0.196813 , 0.200626 ,0.224636 , 0.267892 ,0.242514 , 0.323061 ,0.276774 , 0.352459 ,0.295845 , 0.386896 ,0.306824 , 0.412684 ,0.303923 , 0.442432 ,0.246069 , 0.164965 ,0.262691 , 0.226321 ,0.298214 , 0.294743 ,0.311053 , 0.354488 ,0.324205 , 0.388708 ,0.322566 , 0.423282 ,0.316341 , 0.451764 ,0.297643 , 0.135544 ,0.360091 , 0.280705 ,0.360225 , 0.349636 ,0.348718 , 0.405260 ,0.335387 , 0.438843 ,0.322176 , 0.460958 ,0.406134 , 0.373682 ,0.386722 , 0.399219 ,0.363202 , 0.431872 ,0.339320 , 0.459924 ,0.396687 , 0.430551 ,0.372378 , 0.457435 ,0.345123 , 0.477133 ,0.452302 , 0.450108 ,0.415769 , 0.459913 ,0.374166 , 0.485218 ,0.342099 , 0.489787 ,0.488110 , 0.494337 ,0.458671 , 0.491008 ,0.410814 , 0.500756 ,0.381527 , 0.508004 ,0.351451 , 0.503496 ,0.435171 , 0.535678 ,0.399582 , 0.524716 ,0.371620 , 0.525836 ,0.341638 , 0.518826 ,0.398780 , 0.553303 ,0.356741 , 0.546674 ,0.330724 , 0.524822 ,0.412504 , 0.628109 ,0.382090 , 0.592819 ,0.345477 , 0.570623 ,0.326861 , 0.540486 };
    float uv[] = { 0.066667 , 0.000000 ,0.133333 , 0.000000 ,0.200000 , 0.000000 ,0.266667 , 0.000000 ,0.333333 , 0.000000 ,0.400000 , 0.000000 ,0.466667 , 0.000000 ,0.533333 , 0.000000 ,0.600000 , 0.000000 ,0.666667 , 0.000000 ,0.733333 , 0.000000 ,0.800000 , 0.000000 ,0.866667 , 0.000000 ,0.933333 , 0.000000 ,1.000000 , 0.000000 ,1.000000 , 0.066667 ,1.000000 , 0.133333 ,1.000000 , 0.200000 ,1.000000 , 0.266667 ,0.000000 , 0.000000 ,1.000000 , 0.333333 ,0.030668 , 0.030882 ,0.056004 , 0.056863 ,0.105354 , 0.110297 ,0.142986 , 0.151962 ,0.166789 , 0.177931 ,0.224369 , 0.240141 ,0.272440 , 0.285474 ,0.289851 , 0.303628 ,0.311421 , 0.330914 ,0.345699 , 0.370880 ,0.372673 , 0.394947 ,0.412327 , 0.422337 ,0.448032 , 0.450338 ,0.470301 , 0.472734 ,0.490160 , 0.494637 ,0.497313 , 0.501775 ,0.499861 , 0.504300 ,0.502898 , 0.507260 ,0.998749 , 0.333295 ,0.994996 , 0.333179 ,0.971224 , 0.332447 ,0.945931 , 0.332392 ,0.926082 , 0.334676 ,0.871977 , 0.343869 ,0.810879 , 0.360609 ,0.786300 , 0.367565 ,0.749084 , 0.378649 ,0.694441 , 0.400374 ,0.660653 , 0.420504 ,0.619788 , 0.451502 ,0.580907 , 0.479141 ,0.550753 , 0.492226 ,0.521034 , 0.501382 ,0.510843 , 0.504658 ,0.507216 , 0.505833 ,0.535390 , 0.264014 ,0.278287 , 0.053077 ,0.301395 , 0.113055 ,0.334786 , 0.169092 ,0.376697 , 0.212726 ,0.420642 , 0.239768 ,0.453151 , 0.252656 ,0.484104 , 0.254898 ,0.180352 , 0.130632 ,0.226143 , 0.075837 ,0.263489 , 0.158256 ,0.313888 , 0.220778 ,0.376224 , 0.263404 ,0.431672 , 0.267686 ,0.467509 , 0.266622 ,0.493476 , 0.265033 ,0.486902 , 0.274597 ,0.455747 , 0.284863 ,0.416758 , 0.298804 ,0.366148 , 0.323015 ,0.307763 , 0.281051 ,0.332737 , 0.041755 ,0.342783 , 0.087818 ,0.362884 , 0.134248 ,0.390363 , 0.175487 ,0.424279 , 0.207827 ,0.461829 , 0.234306 ,0.493269 , 0.246757 ,0.388938 , 0.036111 ,0.386412 , 0.073523 ,0.394982 , 0.111251 ,0.412996 , 0.148785 ,0.430536 , 0.180245 ,0.465606 , 0.204430 ,0.491752 , 0.233809 ,0.447162 , 0.033535 ,0.433987 , 0.067856 ,0.425043 , 0.096345 ,0.439775 , 0.126788 ,0.459437 , 0.164694 ,0.488739 , 0.190591 ,0.502668 , 0.219540 ,0.507070 , 0.031930 ,0.486308 , 0.065313 ,0.470058 , 0.102309 ,0.476135 , 0.137341 ,0.502272 , 0.164678 ,0.513710 , 0.199614 ,0.520811 , 0.224779 ,0.569402 , 0.030772 ,0.539549 , 0.061960 ,0.520023 , 0.094286 ,0.509133 , 0.128234 ,0.532460 , 0.150133 ,0.536293 , 0.182143 ,0.531477 , 0.215950 ,0.643207 , 0.028526 ,0.593252 , 0.062217 ,0.561237 , 0.087245 ,0.553853 , 0.120655 ,0.560748 , 0.154954 ,0.562198 , 0.180468 ,0.551182 , 0.209203 ,0.693182 , 0.038999 ,0.646610 , 0.067693 ,0.599508 , 0.097105 ,0.593860 , 0.132632 ,0.585824 , 0.163691 ,0.576941 , 0.192351 ,0.564796 , 0.220289 ,0.740489 , 0.031648 ,0.702273 , 0.067128 ,0.648237 , 0.112185 ,0.614992 , 0.147202 ,0.606205 , 0.174541 ,0.591444 , 0.205916 ,0.569020 , 0.229962 ,0.773658 , 0.052113 ,0.711461 , 0.100129 ,0.676357 , 0.132636 ,0.640834 , 0.152959 ,0.627196 , 0.185128 ,0.611495 , 0.209509 ,0.584451 , 0.229629 ,0.835712 , 0.061022 ,0.759007 , 0.104866 ,0.709234 , 0.131847 ,0.672019 , 0.166059 ,0.641180 , 0.201786 ,0.613207 , 0.225087 ,0.586150 , 0.243285 ,0.884950 , 0.080615 ,0.796655 , 0.128538 ,0.727324 , 0.155546 ,0.682005 , 0.202509 ,0.641156 , 0.222421 ,0.614809 , 0.243892 ,0.582891 , 0.253805 ,0.916093 , 0.124409 ,0.827909 , 0.169719 ,0.745026 , 0.199459 ,0.692754 , 0.233462 ,0.654578 , 0.238832 ,0.630470 , 0.259783 ,0.595214 , 0.264030 ,0.931616 , 0.195017 ,0.852081 , 0.234436 ,0.772647 , 0.250858 ,0.715888 , 0.255583 ,0.666274 , 0.270925 ,0.621476 , 0.281237 ,0.586247 , 0.281451 ,0.949547 , 0.267391 ,0.792244 , 0.322742 ,0.702737 , 0.323210 ,0.646016 , 0.304370 ,0.604634 , 0.306860 ,0.574519 , 0.291114 ,0.653076 , 0.385769 ,0.634960 , 0.339618 ,0.597419 , 0.338096 ,0.571804 , 0.312132 ,0.605879 , 0.379406 ,0.569818 , 0.352464 ,0.549044 , 0.320245 ,0.565554 , 0.458862 ,0.560211 , 0.408986 ,0.534549 , 0.355919 ,0.533658 , 0.316695 ,0.505679 , 0.497788 ,0.516111 , 0.462457 ,0.509780 , 0.402294 ,0.503684 , 0.364150 ,0.515650 , 0.326601 ,0.471525 , 0.433202 ,0.472598 , 0.389051 ,0.485841 , 0.346882 ,0.500780 , 0.311945 ,0.452434 , 0.365444 ,0.469902 , 0.324102 ,0.497114 , 0.298128 ,0.383669 , 0.371205 ,0.421499 , 0.344846 ,0.449258 , 0.309013 ,0.482386 , 0.292453 ,0.501633 , 0.511634 ,0.500637 , 0.515271 ,0.497917 , 0.525446 ,0.492493 , 0.553172 ,0.487732 , 0.582118 ,0.480504 , 0.624063 ,0.471698 , 0.666868 ,0.465279 , 0.698138 ,0.449500 , 0.743969 ,0.436059 , 0.774895 ,0.428547 , 0.797552 ,0.411939 , 0.857256 ,0.371179 , 0.912822 ,0.357957 , 0.934300 ,0.345825 , 0.964647 ,0.335506 , 0.993852 ,0.333876 , 0.998463 ,0.333333 , 1.000000 ,0.266667 , 1.000000 ,0.200000 , 1.000000 ,0.133333 , 1.000000 ,0.066667 , 1.000000 ,0.000000 , 1.000000 ,0.000000 , 0.933333 ,0.000000 , 0.866667 ,0.000000 , 0.800000 ,0.000000 , 0.733333 ,0.000000 , 0.666667 ,0.000000 , 0.600000 ,0.000000 , 0.533333 ,0.000000 , 0.466667 ,0.000000 , 0.400000 ,0.000000 , 0.333333 ,0.000000 , 0.266667 ,0.000000 , 0.200000 ,0.000000 , 0.133333 ,0.000000 , 0.066667 ,0.287421 , 0.596118 ,0.136483 , 0.926237 ,0.201925 , 0.872966 ,0.261282 , 0.811534 ,0.297473 , 0.754608 ,0.310457 , 0.708082 ,0.312198 , 0.676744 ,0.301512 , 0.649569 ,0.308867 , 0.925541 ,0.190306 , 0.941813 ,0.284866 , 0.867948 ,0.334874 , 0.798581 ,0.350280 , 0.728093 ,0.331737 , 0.688034 ,0.324395 , 0.655937 ,0.307711 , 0.632939 ,0.317517 , 0.630134 ,0.338734 , 0.642826 ,0.361354 , 0.671314 ,0.412653 , 0.703983 ,0.403407 , 0.772047 ,0.083672 , 0.938795 ,0.139847 , 0.877610 ,0.198769 , 0.812653 ,0.249783 , 0.762446 ,0.278164 , 0.718914 ,0.292891 , 0.682097 ,0.284458 , 0.653581 ,0.075364 , 0.890129 ,0.142866 , 0.824882 ,0.180490 , 0.782731 ,0.215190 , 0.756403 ,0.247822 , 0.720561 ,0.270555 , 0.685692 ,0.269910 , 0.654429 ,0.052935 , 0.845148 ,0.108225 , 0.811133 ,0.154503 , 0.775037 ,0.191120 , 0.744680 ,0.223155 , 0.715346 ,0.250087 , 0.684569 ,0.257031 , 0.652187 ,0.043941 , 0.792915 ,0.090083 , 0.776709 ,0.133600 , 0.754892 ,0.170718 , 0.731902 ,0.202665 , 0.706663 ,0.232047 , 0.679197 ,0.245689 , 0.646621 ,0.039776 , 0.736284 ,0.080851 , 0.732683 ,0.120945 , 0.723485 ,0.157125 , 0.711088 ,0.185296 , 0.699051 ,0.213654 , 0.669801 ,0.238294 , 0.635801 ,0.037644 , 0.676217 ,0.076218 , 0.682555 ,0.114143 , 0.684146 ,0.149871 , 0.681395 ,0.182316 , 0.675801 ,0.209273 , 0.645471 ,0.235435 , 0.620994 ,0.035927 , 0.611373 ,0.073946 , 0.627091 ,0.110949 , 0.638911 ,0.146020 , 0.645847 ,0.178680 , 0.648003 ,0.207255 , 0.622427 ,0.234935 , 0.605153 ,0.031267 , 0.533055 ,0.072702 , 0.565209 ,0.110233 , 0.588278 ,0.145138 , 0.605552 ,0.177342 , 0.617075 ,0.207866 , 0.597864 ,0.236698 , 0.588363 ,0.036870 , 0.455814 ,0.073370 , 0.498990 ,0.111472 , 0.532466 ,0.147189 , 0.560441 ,0.179091 , 0.582756 ,0.211875 , 0.571412 ,0.241393 , 0.571268 ,0.041945 , 0.401256 ,0.074638 , 0.434914 ,0.113273 , 0.472479 ,0.152063 , 0.509400 ,0.185140 , 0.544195 ,0.221060 , 0.544025 ,0.249910 , 0.556424 ,0.028199 , 0.344027 ,0.070017 , 0.371527 ,0.112350 , 0.409419 ,0.155745 , 0.449687 ,0.199560 , 0.497134 ,0.238483 , 0.523716 ,0.261193 , 0.546993 ,0.057230 , 0.291378 ,0.105742 , 0.348167 ,0.154686 , 0.379741 ,0.202540 , 0.429948 ,0.241887 , 0.478964 ,0.257290 , 0.518758 ,0.272861 , 0.539948 ,0.062222 , 0.220494 ,0.134429 , 0.288767 ,0.217306 , 0.352459 ,0.246055 , 0.421705 ,0.277256 , 0.457321 ,0.272027 , 0.504167 ,0.286373 , 0.533708 ,0.119450 , 0.188989 ,0.267779 , 0.317075 ,0.291287 , 0.389835 ,0.315784 , 0.452954 ,0.296494 , 0.496301 ,0.303065 , 0.532004 ,0.348997 , 0.415367 ,0.356211 , 0.461249 ,0.324457 , 0.497653 ,0.320582 , 0.536243 ,0.381091 , 0.472013 ,0.354609 , 0.507167 ,0.333357 , 0.548271 ,0.437976 , 0.473080 ,0.401219 , 0.497300 ,0.365343 , 0.537440 ,0.338830 , 0.564388 ,0.493552 , 0.510377 ,0.458002 , 0.522692 ,0.399183 , 0.546374 ,0.364861 , 0.561138 ,0.343171 , 0.578975 ,0.469325 , 0.572640 ,0.427896 , 0.581157 ,0.377777 , 0.578514 ,0.346966 , 0.594719 ,0.425897 , 0.615092 ,0.384585 , 0.608724 ,0.341875 , 0.611261 ,0.448147 , 0.667895 ,0.410603 , 0.646424 ,0.361079 , 0.633900 ,0.329325 , 0.622848 ,1.000000 , 0.400000 ,1.000000 , 0.466667 ,1.000000 , 0.533333 ,1.000000 , 0.600000 ,1.000000 , 0.666667 ,1.000000 , 0.733333 ,1.000000 , 0.800000 ,1.000000 , 0.866667 ,1.000000 , 0.933333 ,1.000000 , 1.000000 ,0.933333 , 1.000000 ,0.866667 , 1.000000 ,0.800000 , 1.000000 ,0.733333 , 1.000000 ,0.666667 , 1.000000 ,0.600000 , 1.000000 ,0.533333 , 1.000000 ,0.466667 , 1.000000 ,0.400000 , 1.000000 ,0.681099 , 0.654211 ,0.957403 , 0.571146 ,0.909297 , 0.542610 ,0.858650 , 0.526228 ,0.814511 , 0.524183 ,0.780577 , 0.564762 ,0.746521 , 0.588453 ,0.725109 , 0.617116 ,0.936872 , 0.395054 ,0.949494 , 0.494876 ,0.893393 , 0.460448 ,0.834066 , 0.460054 ,0.772870 , 0.497334 ,0.742212 , 0.554864 ,0.722391 , 0.591440 ,0.707627 , 0.616652 ,0.701907 , 0.603843 ,0.710972 , 0.567715 ,0.719941 , 0.519476 ,0.725786 , 0.449742 ,0.792995 , 0.408260 ,0.963023 , 0.650627 ,0.922606 , 0.605428 ,0.874238 , 0.597536 ,0.826393 , 0.572537 ,0.799211 , 0.601879 ,0.762318 , 0.614085 ,0.730696 , 0.637852 ,0.952081 , 0.712595 ,0.909068 , 0.665222 ,0.862479 , 0.650091 ,0.831172 , 0.620632 ,0.795597 , 0.637378 ,0.758513 , 0.651154 ,0.726440 , 0.652692 ,0.968061 , 0.776210 ,0.920252 , 0.737582 ,0.868801 , 0.702694 ,0.829116 , 0.664374 ,0.793254 , 0.672147 ,0.765831 , 0.676375 ,0.735454 , 0.667552 ,0.936036 , 0.807082 ,0.887465 , 0.761690 ,0.849834 , 0.736598 ,0.823391 , 0.703299 ,0.787074 , 0.700299 ,0.754860 , 0.690722 ,0.725979 , 0.680158 ,0.947814 , 0.885779 ,0.892623 , 0.814562 ,0.857246 , 0.771621 ,0.812266 , 0.743685 ,0.772845 , 0.715566 ,0.741978 , 0.704381 ,0.716506 , 0.683926 ,0.922906 , 0.919180 ,0.883134 , 0.859631 ,0.844041 , 0.801570 ,0.795651 , 0.781788 ,0.768045 , 0.738742 ,0.738639 , 0.724596 ,0.716968 , 0.696954 ,0.915489 , 0.951926 ,0.868091 , 0.898563 ,0.823330 , 0.838133 ,0.779327 , 0.806157 ,0.746895 , 0.762438 ,0.719309 , 0.720464 ,0.704277 , 0.694148 ,0.853113 , 0.941887 ,0.810577 , 0.880621 ,0.782484 , 0.838604 ,0.748276 , 0.809822 ,0.716574 , 0.778247 ,0.709340 , 0.739687 ,0.699733 , 0.704962 ,0.792097 , 0.953852 ,0.785535 , 0.908247 ,0.750912 , 0.858289 ,0.713463 , 0.815197 ,0.692580 , 0.786629 ,0.688891 , 0.755710 ,0.684638 , 0.716299 ,0.726289 , 0.966389 ,0.720977 , 0.906589 ,0.695069 , 0.848939 ,0.677365 , 0.809257 ,0.666610 , 0.774734 ,0.663604 , 0.738663 ,0.665162 , 0.704565 ,0.644659 , 0.937892 ,0.652279 , 0.872514 ,0.655421 , 0.831790 ,0.641043 , 0.798252 ,0.636176 , 0.759895 ,0.640147 , 0.720773 ,0.656320 , 0.692877 ,0.560202 , 0.939874 ,0.586197 , 0.879881 ,0.611351 , 0.829990 ,0.599338 , 0.783846 ,0.606312 , 0.743101 ,0.614585 , 0.714347 ,0.638872 , 0.691961 ,0.482160 , 0.936113 ,0.514865 , 0.885356 ,0.533826 , 0.813658 ,0.567320 , 0.758182 ,0.580304 , 0.721565 ,0.607288 , 0.694336 ,0.633792 , 0.675221 ,0.405954 , 0.934190 ,0.462782 , 0.786011 ,0.516819 , 0.728739 ,0.569502 , 0.690682 ,0.606676 , 0.672243 ,0.635022 , 0.663351 ,0.492860 , 0.677375 ,0.529998 , 0.669069 ,0.575929 , 0.658140 ,0.618521 , 0.651730 ,0.544371 , 0.635415 ,0.586506 , 0.629702 ,0.625896 , 0.632732 ,0.508604 , 0.578598 ,0.548919 , 0.596101 ,0.605400 , 0.604094 ,0.637954 , 0.623922 ,0.509444 , 0.513627 ,0.533375 , 0.537536 ,0.583672 , 0.563300 ,0.615434 , 0.578254 ,0.639420 , 0.604650 ,0.587535 , 0.513975 ,0.611368 , 0.549839 ,0.637312 , 0.569385 ,0.659320 , 0.598034 ,0.632886 , 0.524280 ,0.665442 , 0.561253 ,0.673327 , 0.600673 ,0.675307 , 0.444370 ,0.675869 , 0.499728 ,0.691934 , 0.547473 ,0.687447 , 0.589195 };
    //float uv[] = { 0.066667 , 0.000000 ,0.133333 , 0.000000 ,0.200000 , 0.000000 ,0.266667 , 0.000000 ,0.333333 , 0.000000 ,0.400000 , 0.000000 ,0.466667 , 0.000000 ,0.533333 , 0.000000 ,0.600000 , 0.000000 ,0.666667 , 0.000000 ,0.733333 , 0.000000 ,0.800000 , 0.000000 ,0.866667 , 0.000000 ,0.933333 , 0.000000 ,1.000000 , 0.000000 ,1.000000 , 0.066667 ,1.000000 , 0.133333 ,1.000000 , 0.200000 ,1.000000 , 0.266667 ,0.000000 , 0.000000 ,1.000000 , 0.333333 ,0.019605 , 0.025569 ,0.055760 , 0.052371 ,0.104127 , 0.095895 ,0.144997 , 0.149519 ,0.181204 , 0.204173 ,0.217944 , 0.246292 ,0.249430 , 0.279258 ,0.280684 , 0.320750 ,0.315842 , 0.362602 ,0.358624 , 0.408391 ,0.387820 , 0.437109 ,0.413094 , 0.457034 ,0.434313 , 0.470498 ,0.456966 , 0.487709 ,0.479503 , 0.500308 ,0.491686 , 0.505700 ,0.497339 , 0.509259 ,0.502049 , 0.509253 ,0.997930 , 0.339821 ,0.988426 , 0.332873 ,0.965491 , 0.323808 ,0.929236 , 0.331334 ,0.892421 , 0.341269 ,0.858930 , 0.339636 ,0.820248 , 0.349852 ,0.776697 , 0.369795 ,0.725752 , 0.389691 ,0.667722 , 0.420504 ,0.633285 , 0.437680 ,0.607046 , 0.447035 ,0.578006 , 0.462083 ,0.546479 , 0.483528 ,0.523836 , 0.499145 ,0.512066 , 0.504186 ,0.505318 , 0.506772 ,0.503854 , 0.285773 ,0.280775 , 0.072957 ,0.308776 , 0.132730 ,0.343964 , 0.184534 ,0.383838 , 0.224235 ,0.421976 , 0.251171 ,0.446091 , 0.265973 ,0.474614 , 0.273512 ,0.168606 , 0.124516 ,0.224482 , 0.098129 ,0.264109 , 0.179144 ,0.315535 , 0.227258 ,0.375129 , 0.264414 ,0.429354 , 0.278930 ,0.460610 , 0.282755 ,0.478306 , 0.284620 ,0.475041 , 0.296587 ,0.447678 , 0.307142 ,0.412467 , 0.319784 ,0.368344 , 0.337024 ,0.289200 , 0.294014 ,0.341336 , 0.050410 ,0.353777 , 0.105226 ,0.374551 , 0.154165 ,0.400560 , 0.195527 ,0.428809 , 0.227747 ,0.456588 , 0.253206 ,0.478611 , 0.267882 ,0.399391 , 0.043581 ,0.400668 , 0.091104 ,0.409761 , 0.135293 ,0.425034 , 0.175366 ,0.442629 , 0.209461 ,0.463281 , 0.232660 ,0.480714 , 0.259886 ,0.457489 , 0.041642 ,0.448072 , 0.087237 ,0.445261 , 0.127979 ,0.453591 , 0.159190 ,0.465572 , 0.198488 ,0.479041 , 0.220778 ,0.487355 , 0.253153 ,0.516216 , 0.040860 ,0.497165 , 0.086773 ,0.483082 , 0.136457 ,0.484054 , 0.176074 ,0.493307 , 0.199332 ,0.496036 , 0.233256 ,0.498523 , 0.255248 ,0.576030 , 0.040737 ,0.547257 , 0.084357 ,0.526822 , 0.126914 ,0.514899 , 0.166300 ,0.520751 , 0.184956 ,0.515291 , 0.217809 ,0.506919 , 0.249960 ,0.640916 , 0.041473 ,0.596120 , 0.085809 ,0.564281 , 0.126058 ,0.548227 , 0.161863 ,0.540192 , 0.191987 ,0.534537 , 0.213764 ,0.516960 , 0.246777 ,0.687378 , 0.048030 ,0.642142 , 0.089837 ,0.595329 , 0.135848 ,0.574786 , 0.170401 ,0.556921 , 0.200410 ,0.541202 , 0.227008 ,0.523142 , 0.253683 ,0.736283 , 0.044915 ,0.698335 , 0.084202 ,0.636422 , 0.139865 ,0.588271 , 0.185928 ,0.571233 , 0.210064 ,0.551953 , 0.235035 ,0.529452 , 0.257937 ,0.782635 , 0.058449 ,0.705277 , 0.117382 ,0.659923 , 0.154247 ,0.612410 , 0.189908 ,0.588183 , 0.216854 ,0.570794 , 0.235368 ,0.537500 , 0.258583 ,0.839719 , 0.066226 ,0.752692 , 0.120448 ,0.685985 , 0.163052 ,0.637094 , 0.198927 ,0.598499 , 0.228686 ,0.567590 , 0.249988 ,0.537895 , 0.266680 ,0.886021 , 0.085116 ,0.786428 , 0.141213 ,0.698907 , 0.186548 ,0.647991 , 0.221977 ,0.595178 , 0.247880 ,0.570709 , 0.263613 ,0.540171 , 0.274011 ,0.912726 , 0.129132 ,0.814712 , 0.178460 ,0.716392 , 0.219911 ,0.662013 , 0.247433 ,0.612014 , 0.262200 ,0.588271 , 0.276517 ,0.546430 , 0.280609 ,0.921256 , 0.198528 ,0.836204 , 0.238162 ,0.750516 , 0.264493 ,0.676547 , 0.280304 ,0.620536 , 0.289698 ,0.576850 , 0.294929 ,0.541889 , 0.291235 ,0.929505 , 0.292245 ,0.781495 , 0.336093 ,0.674096 , 0.341589 ,0.601012 , 0.320712 ,0.567580 , 0.318090 ,0.537901 , 0.302989 ,0.630217 , 0.412859 ,0.594736 , 0.361381 ,0.566541 , 0.351144 ,0.536496 , 0.315947 ,0.572712 , 0.397104 ,0.543923 , 0.358092 ,0.524665 , 0.322517 ,0.556975 , 0.456746 ,0.540135 , 0.409035 ,0.520315 , 0.366794 ,0.513086 , 0.328198 ,0.505229 , 0.499632 ,0.508711 , 0.462683 ,0.500638 , 0.416135 ,0.495070 , 0.384440 ,0.503108 , 0.335328 ,0.457147 , 0.468306 ,0.467157 , 0.415921 ,0.478604 , 0.368710 ,0.492019 , 0.328387 ,0.439600 , 0.403004 ,0.462314 , 0.353622 ,0.482760 , 0.320779 ,0.386057 , 0.408180 ,0.420833 , 0.375932 ,0.447037 , 0.337513 ,0.474160 , 0.313274 ,0.498939 , 0.512856 ,0.498125 , 0.519309 ,0.494936 , 0.531407 ,0.489298 , 0.558478 ,0.487419 , 0.588377 ,0.482796 , 0.614415 ,0.476383 , 0.649360 ,0.473186 , 0.688227 ,0.460812 , 0.734962 ,0.450241 , 0.778545 ,0.440580 , 0.822522 ,0.424531 , 0.863967 ,0.393751 , 0.900522 ,0.373060 , 0.937338 ,0.349690 , 0.970338 ,0.341554 , 0.990051 ,0.341374 , 0.998221 ,0.333333 , 1.000000 ,0.266667 , 1.000000 ,0.200000 , 1.000000 ,0.133333 , 1.000000 ,0.066667 , 1.000000 ,0.000000 , 1.000000 ,0.000000 , 0.933333 ,0.000000 , 0.866667 ,0.000000 , 0.800000 ,0.000000 , 0.733333 ,0.000000 , 0.666667 ,0.000000 , 0.600000 ,0.000000 , 0.533333 ,0.000000 , 0.466667 ,0.000000 , 0.400000 ,0.000000 , 0.333333 ,0.000000 , 0.266667 ,0.000000 , 0.200000 ,0.000000 , 0.133333 ,0.000000 , 0.066667 ,0.308093 , 0.630138 ,0.164886 , 0.912160 ,0.221859 , 0.866011 ,0.267531 , 0.810906 ,0.296750 , 0.757052 ,0.310265 , 0.712740 ,0.315933 , 0.686642 ,0.310759 , 0.659632 ,0.330966 , 0.935415 ,0.242977 , 0.926617 ,0.315796 , 0.862232 ,0.338995 , 0.802470 ,0.344807 , 0.739225 ,0.333784 , 0.693013 ,0.328414 , 0.668530 ,0.318862 , 0.651515 ,0.327601 , 0.646796 ,0.347321 , 0.656773 ,0.372039 , 0.677307 ,0.407904 , 0.706936 ,0.424839 , 0.783417 ,0.095425 , 0.925470 ,0.144520 , 0.874818 ,0.199936 , 0.818978 ,0.253756 , 0.764284 ,0.284117 , 0.719980 ,0.300377 , 0.684337 ,0.304038 , 0.658485 ,0.067742 , 0.889691 ,0.141359 , 0.830504 ,0.182822 , 0.793671 ,0.225149 , 0.757593 ,0.261412 , 0.719040 ,0.286591 , 0.683646 ,0.297421 , 0.657442 ,0.052224 , 0.841307 ,0.111225 , 0.809505 ,0.163693 , 0.775585 ,0.207395 , 0.743754 ,0.244954 , 0.711962 ,0.275238 , 0.680416 ,0.291674 , 0.655502 ,0.046553 , 0.787175 ,0.098923 , 0.771192 ,0.149414 , 0.749888 ,0.194531 , 0.726080 ,0.233202 , 0.700788 ,0.266279 , 0.674465 ,0.286971 , 0.652256 ,0.044284 , 0.730156 ,0.093642 , 0.726443 ,0.142269 , 0.716987 ,0.187520 , 0.703129 ,0.226069 , 0.686867 ,0.258049 , 0.665674 ,0.283573 , 0.647369 ,0.043315 , 0.671021 ,0.091379 , 0.678099 ,0.139154 , 0.679651 ,0.185030 , 0.675700 ,0.227846 , 0.666608 ,0.257364 , 0.651156 ,0.282286 , 0.640763 ,0.042795 , 0.608818 ,0.090385 , 0.626564 ,0.137778 , 0.639191 ,0.183721 , 0.645848 ,0.227215 , 0.646185 ,0.256835 , 0.637370 ,0.281806 , 0.633690 ,0.042091 , 0.538630 ,0.089935 , 0.570846 ,0.137286 , 0.595478 ,0.183292 , 0.613606 ,0.226944 , 0.624719 ,0.256892 , 0.623058 ,0.281881 , 0.626258 ,0.044864 , 0.474622 ,0.090266 , 0.513489 ,0.137222 , 0.548285 ,0.183556 , 0.578249 ,0.227480 , 0.601438 ,0.257920 , 0.607782 ,0.282670 , 0.618540 ,0.048541 , 0.421126 ,0.089935 , 0.455796 ,0.136246 , 0.496089 ,0.183865 , 0.537440 ,0.229180 , 0.575083 ,0.260842 , 0.591828 ,0.284709 , 0.611151 ,0.042635 , 0.359116 ,0.083611 , 0.389785 ,0.131826 , 0.434745 ,0.180588 , 0.483451 ,0.233003 , 0.541703 ,0.268384 , 0.579382 ,0.288733 , 0.605621 ,0.064978 , 0.304471 ,0.129814 , 0.376316 ,0.173637 , 0.415274 ,0.219471 , 0.472582 ,0.257076 , 0.526132 ,0.282119 , 0.579570 ,0.294297 , 0.601638 ,0.079870 , 0.241829 ,0.154672 , 0.312864 ,0.218127 , 0.383926 ,0.259298 , 0.466442 ,0.281621 , 0.499464 ,0.289740 , 0.560433 ,0.299998 , 0.595103 ,0.133996 , 0.191295 ,0.261305 , 0.334001 ,0.299323 , 0.424649 ,0.315687 , 0.484776 ,0.306119 , 0.550198 ,0.307923 , 0.590926 ,0.365260 , 0.439890 ,0.351285 , 0.494703 ,0.325494 , 0.549571 ,0.316917 , 0.590620 ,0.375614 , 0.508762 ,0.344720 , 0.555726 ,0.324777 , 0.594465 ,0.431543 , 0.493289 ,0.388040 , 0.534642 ,0.351630 , 0.575499 ,0.328905 , 0.602474 ,0.486825 , 0.516217 ,0.450051 , 0.533148 ,0.387361 , 0.571169 ,0.349104 , 0.595647 ,0.331480 , 0.610922 ,0.469673 , 0.576881 ,0.415894 , 0.591142 ,0.364633 , 0.604663 ,0.336468 , 0.618105 ,0.423220 , 0.618834 ,0.373875 , 0.622650 ,0.338934 , 0.627253 ,0.455977 , 0.669488 ,0.411879 , 0.647746 ,0.364531 , 0.642759 ,0.336835 , 0.638387 ,1.000000 , 0.400000 ,1.000000 , 0.466667 ,1.000000 , 0.533333 ,1.000000 , 0.600000 ,1.000000 , 0.666667 ,1.000000 , 0.733333 ,1.000000 , 0.800000 ,1.000000 , 0.866667 ,1.000000 , 0.933333 ,1.000000 , 1.000000 ,0.933333 , 1.000000 ,0.866667 , 1.000000 ,0.800000 , 1.000000 ,0.733333 , 1.000000 ,0.666667 , 1.000000 ,0.600000 , 1.000000 ,0.533333 , 1.000000 ,0.466667 , 1.000000 ,0.400000 , 1.000000 ,0.695718 , 0.630115 ,0.941077 , 0.557865 ,0.894266 , 0.539031 ,0.850506 , 0.534502 ,0.816339 , 0.536909 ,0.775348 , 0.573941 ,0.747351 , 0.589705 ,0.723543 , 0.612965 ,0.919980 , 0.375542 ,0.930775 , 0.471618 ,0.875169 , 0.447468 ,0.829719 , 0.467848 ,0.779391 , 0.511215 ,0.743149 , 0.562802 ,0.723240 , 0.592604 ,0.711535 , 0.608148 ,0.703012 , 0.597709 ,0.708829 , 0.564746 ,0.715816 , 0.521063 ,0.722133 , 0.464044 ,0.791621 , 0.394553 ,0.952393 , 0.647790 ,0.904240 , 0.611198 ,0.866089 , 0.604641 ,0.816600 , 0.591337 ,0.792894 , 0.605335 ,0.754542 , 0.611958 ,0.725584 , 0.621751 ,0.949164 , 0.706326 ,0.898630 , 0.667270 ,0.860150 , 0.653093 ,0.817259 , 0.631568 ,0.785389 , 0.633213 ,0.754568 , 0.634446 ,0.727046 , 0.631709 ,0.957807 , 0.769738 ,0.916910 , 0.740717 ,0.867000 , 0.705922 ,0.815547 , 0.667181 ,0.783498 , 0.658968 ,0.762110 , 0.655193 ,0.730653 , 0.640310 ,0.939067 , 0.812994 ,0.885817 , 0.762118 ,0.849614 , 0.731784 ,0.809481 , 0.695288 ,0.777679 , 0.678631 ,0.750469 , 0.663258 ,0.725295 , 0.647173 ,0.941813 , 0.879399 ,0.887965 , 0.811852 ,0.844339 , 0.762360 ,0.804148 , 0.726141 ,0.764767 , 0.689199 ,0.743721 , 0.675248 ,0.721959 , 0.654053 ,0.923851 , 0.912831 ,0.876975 , 0.850275 ,0.830905 , 0.788708 ,0.799268 , 0.762653 ,0.765368 , 0.714861 ,0.745464 , 0.697294 ,0.721834 , 0.662391 ,0.903745 , 0.939907 ,0.861072 , 0.887776 ,0.815407 , 0.820235 ,0.785385 , 0.786245 ,0.754845 , 0.734883 ,0.729330 , 0.689415 ,0.714761 , 0.663574 ,0.842964 , 0.936599 ,0.803555 , 0.862041 ,0.776335 , 0.810579 ,0.754662 , 0.781048 ,0.735460 , 0.750255 ,0.723600 , 0.706424 ,0.711363 , 0.670947 ,0.783447 , 0.941565 ,0.766790 , 0.879161 ,0.745332 , 0.826170 ,0.726337 , 0.785207 ,0.714161 , 0.758554 ,0.709508 , 0.720018 ,0.704399 , 0.676323 ,0.722614 , 0.943998 ,0.714383 , 0.877374 ,0.703672 , 0.819386 ,0.695840 , 0.777000 ,0.691449 , 0.740999 ,0.690838 , 0.704268 ,0.693624 , 0.669665 ,0.651264 , 0.930450 ,0.661182 , 0.849996 ,0.667781 , 0.795812 ,0.664005 , 0.763682 ,0.666166 , 0.727937 ,0.671746 , 0.694299 ,0.683482 , 0.664984 ,0.579728 , 0.931387 ,0.600332 , 0.861606 ,0.623412 , 0.796493 ,0.628115 , 0.753365 ,0.639401 , 0.716791 ,0.647618 , 0.693181 ,0.673587 , 0.664136 ,0.503825 , 0.932475 ,0.527541 , 0.864186 ,0.556409 , 0.792964 ,0.596810 , 0.731348 ,0.614914 , 0.700665 ,0.642494 , 0.674309 ,0.668670 , 0.653701 ,0.417685 , 0.935233 ,0.475631 , 0.784014 ,0.535792 , 0.716742 ,0.597684 , 0.677378 ,0.638694 , 0.656081 ,0.663518 , 0.644406 ,0.495418 , 0.672270 ,0.552383 , 0.655745 ,0.602415 , 0.643999 ,0.652361 , 0.637054 ,0.548296 , 0.619292 ,0.607399 , 0.620581 ,0.651734 , 0.625297 ,0.504832 , 0.570760 ,0.562457 , 0.588314 ,0.614935 , 0.598265 ,0.653417 , 0.613750 ,0.511049 , 0.513579 ,0.538410 , 0.535069 ,0.585490 , 0.557672 ,0.617648 , 0.571849 ,0.653656 , 0.602300 ,0.565251 , 0.489678 ,0.613442 , 0.542171 ,0.641450 , 0.565559 ,0.666622 , 0.596822 ,0.635179 , 0.508565 ,0.662571 , 0.555281 ,0.678316 , 0.591822 ,0.656584 , 0.448384 ,0.666122 , 0.500438 ,0.683838 , 0.547673 ,0.689322 , 0.587381 };
    
    meshX = Eigen::Map<MatX3f>(x.data(), x.size() / 3, 3);
    meshF = Eigen::Map<MatX3i>(f.data(), f.size() / 3, 3);


    M.upload(x.data(), x.size() / 3, f.data(), f.size() / 3, uv);

    MyImage img = MyImage(imagefile,3);
    M.tex.setImage(img);

    //////////////////////////////////////////////////////////////////////////
    TwInit(TW_OPENGL_CORE, NULL);
    //Send 'glutGetModifers' function pointer to AntTweakBar;
    //required because the GLUT key event functions do not report key modifiers states.
    TwGLUTModifiersFunc(glutGetModifiers);
    glutSpecialFunc([](int key, int x, int y) { TwEventSpecialGLUT(key, x, y); glutPostRedisplay(); }); // important for special keys like UP/DOWN/LEFT/RIGHT ...
    TwCopyStdStringToClientFunc([](std::string& dst, const std::string& src) {dst = src; });

    createTweakbar();

    //////////////////////////////////////////////////////////////////////////
    atexit([] { TwDeleteAllBars();  TwTerminate(); }); 

    glutTimerFunc(1, [](int) {
        deform_preprocess();
    }, 
        0);


    //////////////////////////////////////////////////////////////////////////
    glutMainLoop();

    return 0;
}
